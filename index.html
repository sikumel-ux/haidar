<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petualangan Angka Pintar</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f7f4;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0;
        }
        .game-container {
            background: white; border-radius: 30px; width: 90%; max-width: 450px;
            padding: 30px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 4px solid #4ecdc4;
        }
        .btn {
            background: #ff6b6b; color: white; border: none; padding: 18px;
            font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer;
            width: 100%; box-shadow: 0 5px #ee5253; margin-top: 10px;
        }
        .opt-btn {
            background: #ffe66d; border: 3px solid #feca57; padding: 18px;
            font-size: 26px; font-weight: bold; border-radius: 15px; margin: 10px 0;
            cursor: pointer; width: 100%; transition: 0.2s;
        }
        .opt-btn:hover { background: #ffd32a; transform: scale(1.02); }
        input {
            padding: 15px; font-size: 18px; border-radius: 15px;
            border: 3px solid #4ecdc4; width: 85%; margin-bottom: 20px; text-align: center;
        }
        .progress-bar { background: #e0e0e0; height: 15px; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        #progress-fill { background: #4ecdc4; height: 100%; width: 0%; transition: 0.4s; }
        #quiz-screen, #feedback-screen, #result-screen { display: none; }
        .q-text { font-size: 48px; font-weight: 800; color: #2d3436; margin: 25px 0; }
        .level-badge { background: #4ecdc4; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 10px; display: inline-block; }
    </style>
</head>
<body>

<div class="game-container">
    <div id="welcome-screen">
        <div style="font-size: 80px;">üöÄ</div>
        <h1>Misi Angka Adaptif</h1>
        <p>Halo! Siapa namamu?</p>
        <input type="text" id="user-name" placeholder="Nama kamu..." autofocus>
        <button class="btn" onclick="startAdventure()">Mulai Petualangan! üéÆ</button>
    </div>

    <div id="quiz-screen">
        <div id="level-indicator" class="level-badge">Level: Angka 1-10</div>
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <div id="step-info" style="font-weight: bold; color: #636e72;">Soal 1 / 25</div>
        <div id="question-text" class="q-text"></div>
        <div id="options"></div>
    </div>

    <div id="feedback-screen">
        <div id="fb-emoji" style="font-size: 100px;"></div>
        <h2 id="fb-msg"></h2>
        <p id="level-change-msg" style="color: #4ecdc4; font-weight: bold;"></p>
        <button class="btn" onclick="generateNext()" style="background:#4ecdc4; box-shadow: 0 5px #45b3a9;">Lanjut ‚û°Ô∏è</button>
    </div>

    <div id="result-screen">
        <div style="font-size: 80px;">üèÜ</div>
        <h2>Misi Selesai!</h2>
        <p id="final-msg" style="font-size: 20px; line-height: 1.5;"></p>
        <button class="btn" onclick="location.reload()">Main Lagi üîÑ</button>
    </div>
</div>

<script>
    let userName = "";
    let currentStep = 0;
    let score = 0;
    let currentAnswer = 0;
    let maxRange = 10; // Level awal
    const totalQuestions = 25;

    function startAdventure() {
        userName = document.getElementById("user-name").value.trim();
        if (!userName) return alert("Namanya diisi dulu ya!");
        document.getElementById("welcome-screen").style.display = "none";
        document.getElementById("quiz-screen").style.display = "block";
        generateQuestion();
    }

    function generateQuestion() {
        document.getElementById("step-info").innerText = `Soal ${currentStep + 1} dari ${totalQuestions}`;
        document.getElementById("progress-fill").style.width = `${(currentStep / totalQuestions) * 100}%`;
        document.getElementById("level-indicator").innerText = `Level: Angka 1 - ${maxRange}`;
        
        let type = Math.floor(Math.random() * 2);
        let n1, n2, qText;

        if (type === 0) { // TAMBAH
            currentAnswer = Math.floor(Math.random() * (maxRange - 1)) + 2; 
            n1 = Math.floor(Math.random() * (currentAnswer - 1)) + 1;
            n2 = currentAnswer - n1;
            qText = `${n1} + ${n2}`;
        } else { // KURANG
            n1 = Math.floor(Math.random() * (maxRange - 2)) + 2; 
            n2 = Math.floor(Math.random() * n1);
            currentAnswer = n1 - n2;
            qText = `${n1} - ${n2}`;
        }

        document.getElementById("question-text").innerText = qText;
        setupOptions(currentAnswer);
    }

    function setupOptions(correct) {
        const optDiv = document.getElementById("options");
        optDiv.innerHTML = "";
        let choices = [correct];
        while (choices.length < 3) {
            let offset = Math.floor(Math.random() * 4) + 1;
            let fake = Math.random() > 0.5 ? correct + offset : correct - offset;
            if (fake >= 0 && !choices.includes(fake)) choices.push(fake);
        }
        choices.sort(() => Math.random() - 0.5);
        choices.forEach(val => {
            const b = document.createElement("button");
            b.className = "opt-btn";
            b.innerText = val;
            b.onclick = () => checkAnswer(val === correct);
            optDiv.appendChild(b);
        });
    }

    function checkAnswer(isCorrect) {
        const levelMsg = document.getElementById("level-change-msg");
        if (isCorrect) {
            score++;
            if (maxRange < 50) {
                maxRange += 5; // Naik level
                levelMsg.innerText = "Keren! Level Naik! üìà";
            } else {
                levelMsg.innerText = "Kamu sudah di level tertinggi! üî•";
            }
        } else {
            if (maxRange > 10) {
                maxRange -= 5; // Turun level
                levelMsg.innerText = "Gak apa-apa, soalnya kita gampangin lagi ya.. üìâ";
            } else {
                levelMsg.innerText = "Jangan menyerah, kamu pasti bisa! üí™";
            }
        }

        document.getElementById("quiz-screen").style.display = "none";
        document.getElementById("feedback-screen").style.display = "block";
        document.getElementById("fb-emoji").innerText = isCorrect ? "‚úÖ" : "‚ùå";
        document.getElementById("fb-msg").innerText = isCorrect ? `Hebat, ${userName}!` : `Yah, ${userName}...`;
    }

    function generateNext() {
        currentStep++;
        document.getElementById("feedback-screen").style.display = "none";
        if (currentStep < totalQuestions) {
            document.getElementById("quiz-screen").style.display = "block";
            generateQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById("result-screen").style.display = "block";
        const wrong = totalQuestions - score;
        let msg = `<b>${userName}</b>, jawabanmu benar ${score}, yang salah ${wrong}.<br>`;
        
        if (score === totalQuestions) {
            msg += "Luar biasa! Kamu jenius matematika sejati! üëë";
        } else if (score > (totalQuestions / 2)) {
            msg += "Bagus sekali! Kamu sudah berusaha keras. ‚ú®";
        } else {
            msg += `Belajar lebih giat lagi ya <b>${userName}</b>! Semangat! üí™`;
        }
        document.getElementById("final-msg").innerHTML = msg;
    }
</script>
</body>
</html>
